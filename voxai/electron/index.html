<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>VoxAI</title>
  <style>
    body { background: #121212; color: #fff; font-family: sans-serif; padding: 1rem; }
    button { margin-right:1rem; padding:0.5rem 1rem; border:none; border-radius:4px; background:#444; color:#ccc;}
    .active { background:#28a745; color:#fff;}
    .card { background:#1a1a1a; padding:1rem; margin-top:1rem; border-radius:6px;}
  </style>
</head>
<body>
  <h1>ðŸŽ§ VoxAI</h1>
  <button id="startBtn">Start</button>
  <button id="stopBtn">Stop</button>
  <button onclick="askAI()">Ask AI</button>

  <div class="card"><h3>Transcript</h3><div id="transcript">...</div></div>
  <div class="card"><h3>Answer</h3><div id="answer">Waiting...</div></div>

  <script>
    const { ipcRenderer } = require('electron');
    let recording = false;
    const startBtn = document.getElementById('startBtn');
    const stopBtn  = document.getElementById('stopBtn');
    const answerEl = document.getElementById('answer');
    const transcriptEl = document.getElementById('transcript');
  
    // State for streaming bullets
    let sentenceBuffer = "";     // holds partial sentence
    let ul;
  
    // Button handlers
    startBtn.onclick = () => {
      recording = true; updateButtons();
      ipcRenderer.send('to-python','START');
    };
    stopBtn.onclick = () => {
      recording = false; updateButtons();
      ipcRenderer.send('to-python','STOP');
    };
    window.askAI = () => {
      // clear old UI
      answerEl.innerHTML = "";
      sentenceBuffer = "";
      // create container for bullets
      ul = document.createElement('ul');
      answerEl.appendChild(ul);
      ipcRenderer.send('to-python','ASK::');
    };
  
    function updateButtons(){
      startBtn.classList.toggle('active', recording);
      stopBtn.classList.toggle('active', !recording);
    }
  
    // As tokens come in, split off complete sentences into <li>
    ipcRenderer.on('from-python', (_, raw) => {
      const [kind, payload] = raw.split('::');
      if (kind === 'TRANSCRIBED') {
        transcriptEl.textContent = payload;
      }
      else if (kind === 'CHUNK') {
        if (payload === '[END]') {
          // Flush any trailing text
          if (sentenceBuffer.trim()) {
            const li = document.createElement('li');
            li.textContent = sentenceBuffer.trim();
            ul.appendChild(li);
          }
        } else {
          // Append new chunk, then extract finished sentences
          sentenceBuffer += payload;
          // Split on sentence endings (". " or "\n")
          const parts = sentenceBuffer.split(/([.?!]\s+)/);
          // parts: [ "First sentence", ". ", "Second sentence", ". ", "incomplete..." ]
          // reassemble
          let incomplete = parts.pop();
          for (let i = 0; i < parts.length; i += 2) {
            const sentence = (parts[i] + parts[i+1]).trim();
            const li = document.createElement('li');
            li.textContent = sentence;
            ul.appendChild(li);
          }
          sentenceBuffer = incomplete;
        }
      }
    });
  
    updateButtons();
  </script>
  
  
</body>
</html>
